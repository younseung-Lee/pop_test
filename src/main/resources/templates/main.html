<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>StoDay POP ì—ë””í„°</title>

    <!-- Fabric.js -->
    <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "ë§‘ì€ ê³ ë”•", system-ui, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
        }

        /* ìƒë‹¨ í—¤ë” */
        .header {
            background: white;
            border-bottom: 1px solid #ddd;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 22px;
            font-weight: bold;
            color: #ff6b6b;
        }

        .header-buttons {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .header-btn:hover {
            background: #f8f8f8;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 15px;
            background: #f8f8f8;
            border-radius: 20px;
            font-size: 13px;
        }

        .logout-btn {
            padding: 8px 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .logout-btn:hover {
            background: #ff5252;
        }

        /* ìƒë‹¨ íˆ´ë°” */
        .toolbar {
            background: white;
            border-bottom: 1px solid #ddd;
            padding: 8px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 13px;
        }

        .toolbar-section {
            display: flex;
            align-items: center;
            gap: 6px;
            padding-right: 16px;
            border-right: 1px solid #ddd;
        }

        .toolbar-section:last-child {
            border-right: none;
        }

        .toolbar-btn {
            padding: 4px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .toolbar-btn:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .toolbar-btn.primary {
            background: #667eea;
            border-color: #667eea;
            color: #fff;
        }
        .toolbar-btn.primary:hover {
            background: #4c5bdc;
        }

        .toolbar-select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            display: grid;
            grid-template-columns: 360px 1fr 360px;
            height: calc(100vh - 108px); /* header(48) + toolbar(60 ì •ë„) */
        }

        /* ì¢Œì¸¡ ì‚¬ì´ë“œë°” */
        .left-sidebar {
            background: #ffffff;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .sidebar-tab {
            flex: 1;
            padding: 10px 4px;
            text-align: center;
            background: #f8f8f8;
            border: none;
            border-right: 1px solid #ddd;
            cursor: pointer;
            font-size: 12px;
            line-height: 1.2;
        }
        .sidebar-tab:last-child {
            border-right: none;
        }
        .sidebar-tab.active {
            background: white;
            font-weight: bold;
        }

        .sidebar-search {
            padding: 10px 12px;
            border-bottom: 1px solid #ddd;
        }

        .search-box {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        .search-select {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 12px;
        }
        .search-input {
            flex: 1;
            padding: 6px 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 12px;
        }
        .search-btn {
            padding: 6px 10px;
            border-radius: 4px;
            border: none;
            background: #667eea;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
        }

        .template-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .template-category {
            margin-bottom: 20px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 2px solid #333;
        }
        .category-title {
            font-size: 14px;
            font-weight: bold;
        }
        .category-count {
            font-size: 12px;
            color: #667eea;
            margin-left: 4px;
        }
        .more-link {
            font-size: 12px;
            color: #667eea;
            text-decoration: none;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .template-item {
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .template-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.18);
        }

        .template-thumb {
            width: 100%;
            height: 120px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 11px;
        }
        .template-name {
            margin-top: 3px;
            font-size: 11px;
            text-align: center;
            color: #333;
        }
        .template-size {
            font-size: 10px;
            text-align: center;
            color: #888;
        }

        /* ì¤‘ì•™: í¸ì§‘ ìº”ë²„ìŠ¤ ì˜ì—­ */
        .center-edit {
            background: #e8e8e8;
            padding: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }

        .edit-box {
            background: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0 0 18px rgba(0,0,0,0.15);
            padding: 8px;
        }

        .canvas-title {
            font-size: 13px;
            margin-bottom: 6px;
            color: #444;
        }

        #editCanvas, #previewCanvas {
            background: #ffffff;
            border: 1px solid #ddd;
            display: block;
        }

        /* ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° íŒ¨ë„ */
        .right-preview {
            background: #ffffff;
            border-left: 1px solid #ddd;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .preview-box {
            width: 100%;
            max-width: 320px;
        }

        .preview-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        /* ìŠ¤í¬ë¡¤ë°” */
        .template-list::-webkit-scrollbar {
            width: 8px;
        }
        .template-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .template-list::-webkit-scrollbar-thumb {
            background: #bbb;
            border-radius: 4px;
        }
        .template-list::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
    </style>
</head>
<body>

<!-- ìƒë‹¨ í—¤ë” -->
<div class="header">
    <div class="header-left">
        <div class="logo">StoDay POP</div>
        <div class="header-buttons">
            <button class="header-btn" type="button" onclick="PopEditor.newWork()">ğŸ“„ ìƒˆ ë¬¸ì„œ</button>
            <button class="header-btn" type="button">âš™ï¸ ê¸°ë³¸ ì‚¬ì´ì¦ˆ</button>
            <button class="header-btn" type="button">âœï¸ ì„œì‹ê³¼ ì§€ì •</button>
            <select class="header-btn" style="padding-right: 24px;">
                <option>A4 ì„¸ë¡œ 1Ã—1</option>
                <option>A4 ê°€ë¡œ 1Ã—1</option>
                <option>A3 ì„¸ë¡œ 1Ã—1</option>
            </select>
            <button class="header-btn" type="button">â“ ì‚¬ì´ì¦ˆ ê°€ì´ë“œ</button>
        </div>
    </div>
    <div class="header-right">
        <div class="user-info-header">
            <span>ğŸ‘¤ <span th:text="${userId}">admin</span> ë‹˜</span>
            <span th:text="${martNm}">í…ŒìŠ¤íŠ¸ë§ˆíŠ¸</span>
        </div>
        <button class="logout-btn" type="button" onclick="location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
</div>

<!-- ìƒë‹¨ íˆ´ë°” -->
<div class="toolbar">
    <div class="toolbar-section">
        <select class="toolbar-select" id="fontFamilySelect">
            <option value="ë§‘ì€ ê³ ë”•">ë§‘ì€ ê³ ë”•</option>
            <option value="ë‚˜ëˆ”ê³ ë”•">ë‚˜ëˆ”ê³ ë”•</option>
            <option value="Gmarket Sans">Gë§ˆì¼“ ì‚°ìŠ¤</option>
        </select>
        <select class="toolbar-select" id="fontSizeSelect">
            <option value="24">24</option>
            <option value="32">32</option>
            <option value="40" selected>40</option>
            <option value="56">56</option>
            <option value="72">72</option>
        </select>
    </div>

    <div class="toolbar-section">
        <button class="toolbar-btn" type="button" onclick="PopEditor.addText()">í…ìŠ¤íŠ¸ ì¶”ê°€</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.deleteSelected()">ì‚­ì œ</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.bringForward()">ì•ìœ¼ë¡œ</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.sendBackward()">ë’¤ë¡œ</button>
    </div>

    <div class="toolbar-section">
        <button class="toolbar-btn primary" type="button" onclick="PopEditor.saveWork()">ì €ì¥</button>
    </div>
</div>

<!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
<div class="main-container">

    <!-- ì¢Œì¸¡ í…œí”Œë¦¿ / ìš”ì†Œ íŒ¨ë„ -->
    <aside class="left-sidebar">
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" type="button">ğŸ“‘ í…œí”Œë¦¿</button>
            <button class="sidebar-tab" type="button">ğŸ‘¤ ìš”ì†Œ</button>
            <button class="sidebar-tab" type="button">ğŸ–¼ ì´ë¯¸ì§€</button>
            <button class="sidebar-tab" type="button">ğŸ“ ê·¸ë£¹ì‘ì„±</button>
        </div>

        <div class="sidebar-search">
            <div class="search-box">
                <select class="search-select" id="templateCategory">
                    <option value="">ì „ì²´</option>
                    <option value="etc">ê¸°íƒ€í…œí”Œë¦¿</option>
                    <option value="holiday">ëª…ì ˆí…œí”Œë¦¿</option>
                </select>
                <input type="text" id="templateKeyword" class="search-input" placeholder="POPëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                <button class="search-btn" type="button" onclick="PopEditor.searchTemplate()">ğŸ”</button>
            </div>
            <div style="margin-top: 6px; font-size: 11px; color:#666;">
                ì „ì²´ í…œí”Œë¦¿
                <strong style="color:#667eea;" th:text="${templateTotalCount}">0</strong> ê°œ
            </div>
        </div>

        <div class="template-list" id="templateList">
            <!-- ì—¬ê¸°ì„œë¶€í„° ë°±ì—”ë“œì—ì„œ categories + templateList ë“±ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ë½‘ì„ ìˆ˜ ìˆìŒ -->
            <div class="template-category">
                <div class="category-header">
                    <div>
                        <span class="category-title">ğŸ“ ì „ì²´ í…œí”Œë¦¿</span>
                    </div>
                    <a href="javascript:void(0)" class="more-link">ë”ë³´ê¸° â€º</a>
                </div>
                <div class="template-grid">
                    <!-- ì‹¤ì œì—ì„  th:each ì‚¬ìš© -->
                    <div class="template-item"
                         th:each="tpl : ${templateList}"
                         th:attr="data-template-id=${tpl.templateId},
                                  data-bg=${tpl.bgImageUrl},
                                  data-w=${tpl.canvasWidth},
                                  data-h=${tpl.canvasHeight}"
                         onclick="PopEditor.loadTemplate(this)">
                        <div class="template-thumb">
                            <img th:src="${tpl.bgImageUrl}"
                                 alt="í…œí”Œë¦¿"
                                 style="width:100%;height:100%;object-fit:cover;border-radius:4px;"
                            />
                        </div>
                        <div class="template-name" th:text="${tpl.templateName}">ìƒ˜í”Œ í…œí”Œë¦¿</div>
                        <div class="template-size" th:text="${tpl.sizeText}">A4 ì„¸ë¡œ 1Ã—1</div>
                    </div>

                    <!-- í…œí”Œë¦¿ì´ ì—†ì„ ë•Œ ì˜ˆì‹œ -->
                    <div class="template-item" th:if="${#lists.isEmpty(templateList)}">
                        <div class="template-thumb">í…œí”Œë¦¿ ì—†ìŒ</div>
                        <div class="template-name">ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”</div>
                        <div class="template-size"></div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- ì¤‘ì•™: í¸ì§‘ìš© ìº”ë²„ìŠ¤ -->
    <section class="center-edit">
        <div class="edit-box">
            <div class="canvas-title">í¸ì§‘ ì¤‘ì¸ POP</div>
            <canvas id="editCanvas" width="800" height="600"></canvas>
        </div>
    </section>

    <!-- ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° -->
    <aside class="right-preview">
        <div class="preview-box">
            <div class="canvas-title">ë¯¸ë¦¬ë³´ê¸°</div>
            <p class="preview-info">ì™¼ìª½ ìº”ë²„ìŠ¤ë¥¼ ìˆ˜ì •í•˜ë©´, ì´ ì˜ì—­ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
            <canvas id="previewCanvas" width="320" height="240"></canvas>
        </div>
    </aside>

</div>

<!-- ì„œë²„ ê°’ ì „ë‹¬ (í•„ìš”í•˜ë©´ ì‚¬ìš©) -->
<script th:inline="javascript">
    const MART_CD  = /*[[${martCd}]]*/ null;
    const USER_ID  = /*[[${userId}]]*/ null;
</script>

<!-- POP ì—ë””í„° JS -->
<script src="/js/popEditor.js"></script>

</body>
</html>
