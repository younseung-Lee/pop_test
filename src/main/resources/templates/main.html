<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POP ì‘ì—…</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/template_delete.css}">
    <link rel="stylesheet" th:href="@{/css/product_search.css}">
</head>
<body th:attr="data-user-id=${user != null ? user.id : ''}">
<div class="header">
    <div class="header-left">
        <div class="logo">StoDay POP</div>
        <div class="header-buttons">
            <button class="header-btn" type="button" onclick="PopEditor.newWork()">ğŸ“„ ìƒˆ ë¬¸ì„œ</button>
            <button class="header-btn" type="button" onclick="PopEditor.saveWork()">POP ì €ì¥</button>
            <!-- a4 ê´€ë¦¬ìë§Œ ë³´ì´ëŠ” ê³µí†µ í…œí”Œë¦¿ ë“±ë¡ ë²„íŠ¼ -->
            <button class="header-btn"
                    type="button"
                    th:if="${user != null and user.id == 'a4'}"
                    onclick="location.href='/templates/common/new'">
                â• ê³µí†µ í…œí”Œë¦¿ ë“±ë¡
            </button>
        </div>
    </div>
    <div class="header-right">
        <div class="user-info-header">
            <span>ğŸ‘¤ <span th:text="${user.nm}">admin</span>ë‹˜</span>
        </div>
        <button class="logout-btn" type="button" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
</div>

<div class="toolbar">
    <div class="toolbar-section">
        <select class="toolbar-select" id="fontFamilySelect">
            <option value="Gmarket Sans">Gë§ˆì¼“ ì‚°ìŠ¤ Bold</option>
            <option value="Nanum Gothic">ë‚˜ëˆ”ê³ ë”•</option>
            <option value="Malgun Gothic">ë§‘ì€ ê³ ë”•</option>
        </select>
        <select class="toolbar-select" id="fontSizeSelect">
            <option value="12">12</option>
            <option value="14">14</option>
            <option value="16">16</option>
            <option value="18">18</option>
            <option value="24">24</option>
            <option value="28">28</option>
            <option value="32">32</option>
            <option value="36" selected>36</option>
            <option value="48">48</option>
            <option value="60">60</option>
            <option value="72">72</option>
            <option value="96">96</option>
        </select>
        <button class="toolbar-btn" type="button" onclick="PopEditor.applyTextStyle()">í°íŠ¸ ì ìš©</button>
    </div>
    <div class="toolbar-section">
        <button class="toolbar-btn" type="button"><strong>ê°€</strong></button>
        <button class="toolbar-btn" type="button"><em>ê°€</em></button>
        <button class="toolbar-btn" type="button"><u>ê°€</u></button>
        <button class="toolbar-btn" type="button">ê°€</button>
        <button class="toolbar-btn" type="button">ê°€</button>
    </div>
    <div class="toolbar-section">
        <button class="toolbar-btn" type="button" onclick="PopEditor.addText()">ğŸ“ í…ìŠ¤íŠ¸ ì¶”ê°€</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.addShape('rectangle')">â–¡ ì‚¬ê°í˜•</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.addShape('circle')">â—‹ ì›í˜•</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.addImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
    <div class="toolbar-section">
        <label style="font-size: 14px; margin-right: 5px;">ì±„ìš°ê¸°:</label>
        <input type="color" id="fillColorPicker" value="#ffffff" style="width: 40px; height: 30px; border: 1px solid #ddd; cursor: pointer;">
        <label style="font-size: 14px; margin: 0 5px;">í…Œë‘ë¦¬:</label>
        <input type="color" id="strokeColorPicker" value="#000000" style="width: 40px; height: 30px; border: 1px solid #ddd; cursor: pointer;">
        <button class="toolbar-btn" type="button" onclick="PopEditor.applyColors()">ìƒ‰ìƒ ì ìš©</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.removeColors()">ìƒ‰ìƒ ì œê±°</button>
    </div>
    <div class="toolbar-section">
        <button class="toolbar-btn" type="button" onclick="PopEditor.deleteSelected()">ì‚­ì œ</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.bringForward()">ì•ìœ¼ë¡œ</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.sendBackward()">ë’¤ë¡œ</button>
    </div>
</div>

<!-- ìˆ¨ê¹€: ì´ë¯¸ì§€ ì—…ë¡œë“œ input -->
<input type="file" id="imageFileInput" accept="image/*" style="display:none;">

<div class="main-container">

    <!-- ì™¼ìª½: í…œí”Œë¦¿ / ìƒí’ˆê²€ìƒ‰ -->
    <aside class="left-sidebar">
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" type="button" onclick="toggleSidebarTab('template')">ğŸ“‘ í…œí”Œë¦¿</button>
            <button class="sidebar-tab" type="button" onclick="toggleSidebarTab('product')">ğŸ” ìƒí’ˆ ì´ë¯¸ì§€ê²€ìƒ‰</button>
        </div>

        <!-- ìƒí’ˆ ì´ë¯¸ì§€ ê²€ìƒ‰ ì˜ì—­ -->
        <div class="product-search-container" id="productSearchContainer">
            <div class="product-search-box">
                <div class="search-input-group">
                    <select class="search-type-select" id="productSearchType">
                        <option value="NAME">ìƒí’ˆëª…</option>
                        <option value="CODE">ë°”ì½”ë“œ</option>
                    </select>
                    <input type="text" 
                           class="search-keyword-input" 
                           id="productSearchKeyword" 
                           placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    <button class="search-btn" id="productSearchBtn" type="button">ê²€ìƒ‰</button>
                </div>
                <div class="search-result-info">
                    ì´ <span class="search-result-count" id="productSearchCount">0</span>ê°œì˜ ìƒí’ˆ
                </div>
            </div>
            
            <div class="product-image-grid" id="productImageGrid">
                <div class="empty-result" style="grid-column: 1 / -1;">
                    <h3>ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</h3>
                    <p>ìƒí’ˆëª… ë˜ëŠ” ë°”ì½”ë“œë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <!-- í…œí”Œë¦¿ ë ˆì´ì•„ì›ƒ / ì¹´í…Œê³ ë¦¬ / ì†ŒìŠ¤ í•„í„° ì˜ì—­ -->
        <div class="template-container" id="templateContainer">
        <div class="sidebar-search">
            <div class="search-box">
                <!-- í…œí”Œë¦¿ íƒ€ì…: ê³µí†µ / ìš°ë¦¬ ë§ˆíŠ¸ -->
                <select class="search-select" id="templateSource"
                        onchange="PopEditor.filterTemplateByLayout()">
                    <option value="COMMON" selected>ê³µí†µ í…œí”Œë¦¿</option>
                    <option value="MY">ìš°ë¦¬ ë§ˆíŠ¸ í…œí”Œë¦¿</option>
                </select>

                <!-- ë ˆì´ì•„ì›ƒ ì„ íƒ: ì „ì²´ / ì„¸ë¡œí˜• / ê°€ë¡œí˜• / ì‡¼ì¹´ë“œ -->
                <select class="search-select" id="templateLayout"
                        onchange="PopEditor.filterTemplateByLayout()">
                    <option value="">ì „ì²´ ë ˆì´ì•„ì›ƒ</option>
                    <option value="VERTICAL">ì„¸ë¡œí˜•</option>
                    <option value="HORIZONTAL">ê°€ë¡œí˜•</option>
                    <option value="SHOWCARD">ì‡¼ì¹´ë“œ</option>
                </select>

                <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ: ë™ì ìœ¼ë¡œ ë¡œë“œ -->
                <select class="search-select" id="templateCategory"
                        onchange="PopEditor.filterTemplateByLayout()">
                    <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                    <!-- ì¹´í…Œê³ ë¦¬ëŠ” JavaScriptë¡œ ë™ì  ë¡œë“œë¨ -->
                </select>
            </div>

            <div style="margin-top: 6px; font-size: 16px; color:#666;">
                ì „ì²´ í…œí”Œë¦¿
                <strong id="templateTotalCount" style="color:#667eea;" th:text="${templateTotalCount}">0</strong> ê°œ
            </div>
        </div>

        <!-- í…œí”Œë¦¿ ë¦¬ìŠ¤íŠ¸ -->
        <div class="template-list" id="templateList">
            <div class="template-category">
                <div class="category-header">
                    <div>
                        <span class="category-title">
                            ğŸ“
                            <span id="currentSourceLabel">ê³µí†µ í…œí”Œë¦¿</span>
                            Â·
                            <span id="currentLayoutLabel">ì „ì²´ ë ˆì´ì•„ì›ƒ</span>
                            /
                            <span id="currentCategoryLabel">ì „ì²´ ì¹´í…Œê³ ë¦¬</span>
                        </span>
                    </div>
                </div>

                <div class="template-grid">
                    <div class="template-item"
                         th:each="tpl : ${templateList}"
                         th:attr="
                           data-template-id=${tpl.tplId},
                           data-tpl-seq=${tpl.tplSeq},
                           data-bg=${tpl.bgImgUrl},
                           data-layout=${tpl.layoutType},
                           data-tpl-json=${tpl.tplJson},
                           data-ctgy-big=${tpl.tplCtgyBig},
                           data-ctgy-mid=${tpl.tplCtgyMid},
                           data-ctgy-sml=${tpl.tplCtgySml},
                           data-ctgy-sub=${tpl.tplCtgySub}
                         ">
                        <div class="template-thumb">
                            <!-- ì¸ë„¤ì¼ì´ ìˆìœ¼ë©´ ì¸ë„¤ì¼ ì‚¬ìš©, ì—†ìœ¼ë©´ ë°°ê²½ ì´ë¯¸ì§€ ì‚¬ìš© -->
                            <img th:src="${tpl.thumbnailUrl != null && !#strings.isEmpty(tpl.thumbnailUrl) ? tpl.thumbnailUrl : tpl.bgImgUrl}"
                                 alt="í…œí”Œë¦¿"
                                 style="width:100%;height:100%;object-fit:cover;border-radius:4px;"/>
                            
                            <!-- ì‚­ì œ ë²„íŠ¼: a4 ê´€ë¦¬ìëŠ” ëª¨ë“  í…œí”Œë¦¿, ì¼ë°˜ ë§ˆíŠ¸ëŠ” ìì‹ ì˜ ìš°ë¦¬ë§¤ì¥ í…œí”Œë¦¿ë§Œ -->
                            <button class="delete-template-btn" 
                                    type="button"
                                    value="DELETE"
                                    th:if="${(user != null and user.id == 'a4') or (user != null and tpl.isCommon == 'N' and tpl.martCd == user.id)}"
                                    th:attr="data-tpl-seq=${tpl.tplSeq}, data-tpl-nm=${tpl.tplNm}"
                                    onclick="deleteTemplate(event, this.dataset.tplSeq, this.dataset.tplNm)"
                                    title="í…œí”Œë¦¿ ì‚­ì œ">
                                âŒ
                            </button>
                        </div>
                        <div class="template-name" th:text="${tpl.tplNm}">ìƒ˜í”Œ í…œí”Œë¦¿</div>
                        <div class="template-size"></div>
                    </div>

                    <!-- ì¡°íšŒ ê²°ê³¼ ì—†ì„ ë•Œ -->
                    <div class="template-item" th:if="${#lists.isEmpty(templateList)}">
                        <div class="template-thumb">í…œí”Œë¦¿ ì—†ìŒ</div>
                        <div class="template-name">ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                        <div class="template-size"></div>
                    </div>
                </div>

                <!-- í˜ì´ì§• ì˜ì—­ -->
                <div class="template-pagination" style="margin-top:8px; display:flex; align-items:center; gap:8px;">
                    <button type="button" id="tplPrevPage" class="toolbar-btn">ì´ì „</button>
                    <span id="tplPageInfo" style="font-size:14px; color:#555;">1 / 1 í˜ì´ì§€</span>
                    <button type="button" id="tplNextPage" class="toolbar-btn">ë‹¤ìŒ</button>
                </div>
            </div>
        </div>
        </div>
    </aside>

    <!-- ê°€ìš´ë°: í¸ì§‘ ìº”ë²„ìŠ¤ -->
    <section class="canvas-area">
        <div class="canvas-wrapper">
            <canvas id="editCanvas" width="800" height="600"></canvas>

            <div class="empty-canvas-message">
                <h3>POP ì‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”</h3>
                <p>ì¢Œì¸¡ í…œí”Œë¦¿ì„ ì„ íƒí•˜ê±°ë‚˜ íˆ´ë°”ì—ì„œ í…ìŠ¤íŠ¸/ë„í˜•/ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
            </div>
        </div>
    </section>

    <!-- ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° -->
    <aside class="right-preview">
        <div class="preview-box">
            <div class="preview-header-wrapper">
                <div class="preview-title">ë¯¸ë¦¬ë³´ê¸°</div>
                <button class="print-btn" type="button" onclick="printPreview()" title="ë¯¸ë¦¬ë³´ê¸° ì¸ì‡„">
                    ğŸ–¨ï¸ ì¸ì‡„
                </button>
            </div>
            <p class="preview-info">ì™¼ìª½ ìº”ë²„ìŠ¤ë¥¼ ìˆ˜ì •í•˜ë©´, ì´ ì˜ì—­ì— ì¶•ì†Œë³¸ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
            <div id="previewContainer">
                <canvas id="previewCanvas" width="800" height="600"></canvas>
            </div>
        </div>
    </aside>

</div>

<div id="previewZoomModal" class="preview-zoom-modal" aria-hidden="true">
    <div class="preview-zoom-overlay"></div>
    <div class="preview-zoom-content" role="dialog" aria-modal="true">
        <canvas id="previewZoomCanvas"></canvas>
    </div>
</div>
<!-- ì €ì¥ ëª¨ë‹¬ -->
<div id="saveModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>í…œí”Œë¦¿ ì €ì¥</h3>
            <button type="button" class="modal-close" onclick="PopEditor.closeSaveModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="modal-row">
                <label for="saveTplNm">í…œí”Œë¦¿ëª… <span class="required">*</span></label>
                <input type="text" id="saveTplNm" placeholder="ì˜ˆ) ê²¨ìš¸ í–‰ì‚¬ POP" />
            </div>
            <div class="modal-row">
                <label for="saveCtgyBig">ì¹´í…Œê³ ë¦¬(ëŒ€) <span class="required">*</span></label>
                <input type="text" id="saveCtgyBig" placeholder="ì˜ˆ) ë´„, ëª…ì ˆ, ìƒì„ , ê°€ì„" />
            </div>
            <div class="modal-row">
                <label for="saveLayoutType">ë ˆì´ì•„ì›ƒ <span class="required">*</span></label>
                <select id="saveLayoutType">
                    <option value="VERTICAL">ì„¸ë¡œí˜•</option>
                    <option value="HORIZONTAL">ê°€ë¡œí˜•</option>
                    <option value="SHOWCARD">ì‡¼ì¹´ë“œ</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" onclick="PopEditor.closeSaveModal()">ì·¨ì†Œ</button>
            <button type="button" class="btn primary" onclick="PopEditor.confirmSave()">ì €ì¥</button>
        </div>
    </div>
</div>

<!-- Fabric.js v6.9.0 ë¡œë“œ -->
<script src="https://cdn.jsdelivr.net/npm/fabric@6.9.0/dist/index.js"></script>
<!-- POP ì—ë””í„° ìŠ¤í¬ë¦½íŠ¸ -->
<script th:src="@{/js/popEditor.js}"></script>
<!-- ìƒí’ˆ ì´ë¯¸ì§€ ê²€ìƒ‰ ìŠ¤í¬ë¦½íŠ¸ -->
<script th:src="@{/js/productSearch.js}"></script>

<script>
    function logout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            window.location.href = '/logout';
        }
    }

    // í…œí”Œë¦¿ ì‚­ì œ í•¨ìˆ˜
    async function deleteTemplate(event, tplSeq, tplNm) {
        // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€ (í´ë¦­ ì‹œ í…œí”Œë¦¿ ë¡œë“œ ë°©ì§€)
        event.stopPropagation();

        if (!confirm(`"${tplNm}" í…œí”Œë¦¿ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œëœ í…œí”Œë¦¿ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
            return;
        }

        try {
            const response = await fetch(`/api/templates/${tplSeq}`, {
                method: 'DELETE'
            });

            const data = await response.json().catch(() => ({}));

            if (!response.ok || !data.success) {
                const errorMsg = data.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                alert('ì˜¤ë¥˜: ' + errorMsg);
                return;
            }

            alert(`"${tplNm}" í…œí”Œë¦¿ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);

            // í…œí”Œë¦¿ ëª©ë¡ ì¬ë¡œë“œ
            if (typeof PopEditor !== 'undefined' && PopEditor.filterTemplateByLayout) {
                PopEditor.filterTemplateByLayout();
            } else {
                location.reload();
            }

        } catch (error) {
            console.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
            alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadCategories() {
        try {
            const response = await fetch('/api/templates/categories');
            const data = await response.json();

            if (data.success && data.categories && data.categories.length > 0) {
                const categorySelect = document.getElementById('templateCategory');

                // ê¸°ì¡´ ì˜µì…˜ ìœ ì§€ (ì „ì²´ ì¹´í…Œê³ ë¦¬)
                const currentValue = categorySelect.value;

                // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ 'ì „ì²´ ì¹´í…Œê³ ë¦¬' ì œì™¸)
                while (categorySelect.options.length > 1) {
                    categorySelect.remove(1);
                }

                // ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
                data.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });

                // ì´ì „ ì„ íƒê°’ ë³µì›
                if (currentValue) {
                    categorySelect.value = currentValue;
                }

                console.log(`ì¹´í…Œê³ ë¦¬ ${data.categories.length}ê°œ ë¡œë“œ ì™„ë£Œ`);
            }
        } catch (error) {
            console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
        }
    }

    // ì‚¬ì´ë“œë°” íƒ­ ì „í™˜
    function toggleSidebarTab(type) {
        const templateContainer = document.getElementById('templateContainer');
        const productContainer = document.getElementById('productSearchContainer');
        const tabs = document.querySelectorAll('.sidebar-tab');
        
        // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
        tabs.forEach(tab => tab.classList.remove('active'));
        
        if (type === 'template') {
            templateContainer.classList.remove('hidden');
            productContainer.classList.remove('active');
            tabs[0].classList.add('active');
        } else if (type === 'product') {
            templateContainer.classList.add('hidden');
            productContainer.classList.add('active');
            tabs[1].classList.add('active');
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
    window.addEventListener('DOMContentLoaded', function() {
        loadCategories();
    });

    /**
     * ë¯¸ë¦¬ë³´ê¸° Canvas ì¸ì‡„ í•¨ìˆ˜
     */
    function printPreview() {
        const canvas = document.getElementById('previewCanvas');
        
        if (!canvas) {
            alert('ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        // Canvasê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
        const ctx = canvas.getContext('2d');
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const isEmpty = !imageData.data.some(channel => channel !== 0);
        
        if (isEmpty) {
            alert('ì¸ì‡„í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        // Canvasë¥¼ ê³ í•´ìƒë„ ì´ë¯¸ì§€ë¡œ ë³€í™˜ (2ë°° ìŠ¤ì¼€ì¼)
        const scale = 2;
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width * scale;
        tempCanvas.height = canvas.height * scale;
        
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.scale(scale, scale);
        tempCtx.drawImage(canvas, 0, 0);
        
        const dataUrl = tempCanvas.toDataURL('image/png', 1.0);
        
        // ì¸ì‡„ìš© íŒì—… ì°½ ìƒì„±
        const printWindow = window.open('', '_blank', 'width=900,height=700');
        
        if (!printWindow) {
            alert('íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>POP ì¸ì‡„</title>
                <style>
                    * { 
                        margin: 0; 
                        padding: 0; 
                        box-sizing: border-box; 
                    }
                    body {
                        margin: 0;
                        padding: 0;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        min-height: 100vh;
                    }
                    img {
                        max-width: 100%;
                        height: auto;
                        display: block;
                    }
                    @media print {
                        body { 
                            margin: 0;
                            padding: 0;
                        }
                        img {
                            max-width: 100%;
                            height: auto;
                            page-break-inside: avoid;
                        }
                    }
                </style>
            </head>
            <body>
                <img src="${dataUrl}" alt="POP í…œí”Œë¦¿" onload="window.print(); window.close();" />
            </body>
            </html>
        `);
        
        printWindow.document.close();
    }
</script>
</body>
</html>
