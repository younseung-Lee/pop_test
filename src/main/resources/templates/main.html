<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POP 작업</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
<div class="header">
    <div class="header-left">
        <div class="logo">StoDay POP</div>
        <div class="header-buttons">
            <button class="header-btn" type="button" onclick="PopEditor.newWork()">📄 새 문서</button>
            <button class="header-btn" type="button">⚙️ 기본 사이즈</button>
            <select class="header-btn">
                <option>A4 세로1*1</option>
                <option>A4 가로1*1</option>
                <option>A3 세로1*1</option>
            </select>
            <button class="header-btn" type="button">❓ 사이즈가이드보기</button>
        </div>
    </div>
    <div class="header-right">
        <div class="user-info-header">
            <span>👤 <span th:text="${user.id}">admin</span>님</span>
        </div>
        <button class="logout-btn" type="button" onclick="logout()">로그아웃</button>
    </div>
</div>

<div class="toolbar">
    <div class="toolbar-section">
        <select class="toolbar-select" id="fontFamilySelect">
            <option value="Gmarket Sans">G마켓 산스 Bold</option>
            <option value="Nanum Gothic">나눔고딕</option>
            <option value="Malgun Gothic">맑은 고딕</option>
        </select>
        <select class="toolbar-select" id="fontSizeSelect">
            <option value="36">36</option>
            <option value="24">24</option>
            <option value="18">18</option>
        </select>
    </div>
    <div class="toolbar-section">
        <button class="toolbar-btn" type="button"><strong>가</strong></button>
        <button class="toolbar-btn" type="button"><em>가</em></button>
        <button class="toolbar-btn" type="button"><u>가</u></button>
        <button class="toolbar-btn" type="button">가</button>
        <button class="toolbar-btn" type="button">가</button>
    </div>
    <div class="toolbar-section">
        <button class="toolbar-btn" type="button" onclick="PopEditor.addText()">📝 텍스트 추가</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.addShape('rectangle')">□ 사각형</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.addShape('circle')">○ 원형</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.addImage()">🖼️ 이미지</button>
    </div>
    <div class="toolbar-section">
        <button class="toolbar-btn" type="button" onclick="PopEditor.deleteSelected()">삭제</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.bringForward()">앞으로</button>
        <button class="toolbar-btn" type="button" onclick="PopEditor.sendBackward()">뒤로</button>
    </div>
    <div class="toolbar-section">
        <button class="toolbar-btn primary" type="button" onclick="PopEditor.saveWork()">저장</button>
    </div>
</div>

<!-- 숨김: 이미지 업로드 input -->
<input type="file" id="imageFileInput" accept="image/*" style="display:none;">

<div class="main-container">

    <!-- 왼쪽: 템플릿 / 상품검색 -->
    <aside class="left-sidebar">
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" type="button">📑 템플릿</button>
            <button class="sidebar-tab" type="button">👤 상품검색</button>
        </div>

        <div class="sidebar-search">
            <div class="search-box">
                <select class="search-select" id="templateCategory">
                    <option value="">전체</option>
                    <option value="etc">기타템플릿</option>
                    <option value="holiday">명절템플릿</option>
                </select>
                <input type="text" id="templateKeyword" class="search-input" placeholder="POP명을 입력하세요">
                <button class="search-btn" type="button" onclick="PopEditor.searchTemplate()">🔍</button>
            </div>
            <div style="margin-top: 6px; font-size: 11px; color:#666;">
                전체 템플릿
                <strong style="color:#667eea;" th:text="${templateTotalCount}">0</strong> 개
            </div>
        </div>

        <div class="template-list" id="templateList">
            <div class="template-category">
                <div class="category-header">
                    <div>
                        <span class="category-title">📁 전체 템플릿</span>
                    </div>
                    <a href="javascript:void(0)" class="more-link">더보기 ›</a>
                </div>
                <div class="template-grid">
                    <div class="template-item"
                         th:each="tpl : ${templateList}"
                         th:attr="data-template-id=${tpl.templateId},
                                  data-bg=${tpl.bgImageUrl},
                                  data-w=${tpl.canvasWidth},
                                  data-h=${tpl.canvasHeight}">
                        <div class="template-thumb">
                            <img th:src="${tpl.bgImageUrl}"
                                 alt="템플릿"
                                 style="width:100%;height:100%;object-fit:cover;border-radius:4px;"/>
                        </div>
                        <div class="template-name" th:text="${tpl.templateName}">샘플 템플릿</div>
                        <div class="template-size" th:text="${tpl.sizeText}">A4 세로 1×1</div>
                    </div>

                    <div class="template-item" th:if="${#lists.isEmpty(templateList)}">
                        <div class="template-thumb">템플릿 없음</div>
                        <div class="template-name">관리자에게 문의하세요</div>
                        <div class="template-size"></div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- 가운데: 편집 캔버스 -->
    <section class="canvas-area">
        <div class="canvas-wrapper">
            <!-- Fabric 주 캔버스 -->
            <canvas id="editCanvas" width="800" height="600"></canvas>

            <!-- 템플릿/오브젝트 없을 때만 보이는 안내 -->
            <div class="empty-canvas-message">
                <h3>POP 작업을 시작하세요</h3>
                <p>좌측 템플릿을 선택하거나 툴바에서 텍스트/도형/이미지를 추가해보세요.</p>
            </div>
        </div>
    </section>

    <!-- 오른쪽: 미리보기 -->
    <aside class="right-preview">
        <div class="preview-box">
            <div class="preview-title">미리보기</div>
            <p class="preview-info">왼쪽 캔버스를 수정하면, 이 영역에 축소본으로 표시됩니다.</p>

            <div id="previewContainer">
                <!-- 미리보기용 Fabric 캔버스 -->
                <canvas id="previewCanvas" width="800" height="600"></canvas>
            </div>
        </div>
    </aside>

</div>

<!-- Fabric.js 먼저 로드 -->
<script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
<!-- POP 에디터 스크립트 -->
<script th:src="@{/js/popEditor.js}"></script>

<script>
    function logout() {
        if (confirm('로그아웃 하시겠습니까?')) {
            window.location.href = '/logout';
        }
    }
</script>
</body>
</html>
